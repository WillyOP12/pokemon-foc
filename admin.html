<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gestió de Cartes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Gestió de la Col·lecció de Cartes</h1>

<!-- Formulari per afegir una nova carta amb imatge -->
<h2>Afegeix una nova carta</h2>
<form id="addCardForm">
    <label for="cardName">Nom de la carta:</label>
    <input type="text" id="cardName" required>

    <label for="cardRarity">Raresa de la carta:</label>
    <select id="cardRarity" required>
        <option value="Common">Common</option>
        <option value="Uncommon">Uncommon</option>
        <option value="Rare">Rare</option>
        <option value="Ultra Rare">Ultra Rare</option>
    </select>

    <label for="cardImage">Imatge de la carta:</label>
    <input type="file" id="cardImage" accept="image/*" required>

    <button type="submit">Afegeix la carta</button>
</form>

<!-- Taula per mostrar les cartes de la col·lecció -->
<h2>Cartes de la col·lecció</h2>
<table id="cardsTable">
    <thead>
        <tr>
            <th>Nom de la Carta</th>
            <th>Raresa</th>
            <th>Imatge</th>
            <th>Acció</th>
        </tr>
    </thead>
    <tbody>
        <!-- Aquí es mostraran les cartes -->
    </tbody>
</table>

<script>
    // Comprovar si l'usuari és admin
    if (localStorage.getItem("isAdmin") !== "true") {
        window.location.href = "home.html"; // Redirigir a home si no és admin
    }

    // Funció per mostrar les cartes de la col·lecció
    function showCards() {
        const cards = JSON.parse(localStorage.getItem("cards")) || [];
        const tableBody = document.querySelector("#cardsTable tbody");

        // Netejar la taula abans de mostrar noves cartes
        tableBody.innerHTML = '';

        cards.forEach((card, index) => {
            // Crear una nova fila per a cada carta
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${card.name}</td>
                <td>${card.rarity}</td>
                <td><img src="${card.image}" alt="Imatge de la carta" width="100"></td>
                <td><button onclick="deleteCard(${index})">Eliminar</button></td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Funció per afegir una nova carta
    document.getElementById('addCardForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const name = document.getElementById('cardName').value;
        const rarity = document.getElementById('cardRarity').value;
        const imageInput = document.getElementById('cardImage');
        
        // Convertir la imatge a base64
        const reader = new FileReader();
        reader.onloadend = function() {
            const image = reader.result; // Conté la imatge en format base64

            const newCard = { name, rarity, image };

            // Afegir la nova carta al localStorage
            const cards = JSON.parse(localStorage.getItem("cards")) || [];
            cards.push(newCard);
            localStorage.setItem("cards", JSON.stringify(cards));

            // Actualitzar la vista de les cartes
            showCards();
        };

        // Llegir la imatge com a base64
        if (imageInput.files[0]) {
            reader.readAsDataURL(imageInput.files[0]);
        }
    });

    // Funció per eliminar una carta de la col·lecció
    function deleteCard(index) {
        // Obtenir les cartes del localStorage
        const cards = JSON.parse(localStorage.getItem("cards")) || [];

        // Eliminar la carta seleccionada
        cards.splice(index, 1);

        // Actualitzar el localStorage amb la nova col·lecció
        localStorage.setItem("cards", JSON.stringify(cards));

        // Mostrar les cartes actualitzades
        showCards();
    }

    // Mostrar les cartes quan es carrega la pàgina
    showCards();
</script>

</body>
</html>
